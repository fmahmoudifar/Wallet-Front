{% extends "layout.html" %}

{% block content %}

<style>
    /* Common form styles */
    form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        align-items: end;
        row-gap: 20px;
        justify-items: end;
        margin-bottom: 1rem;
    }

    /* Standard size for inputs and selects */
    input[type="text"],
    input[type="datetime-local"],
    select {
        width: 220px;
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
    }

    select {
        height: 36px; /* make dropdown same height as input */
    }

    /* Labels aligned nicely */
    label {
        margin-right: 10px;
        font-weight: bold;
    }

    /* Buttons styling */
    button {
        padding: 6px 12px;
        margin: 2px;
        border: none;
        border-radius: 5px;
        background-color: #0077cc;
        color: white;
        cursor: pointer;
        font-size: 14px;
    }

    button:hover {
        background-color: #005fa3;
    }

    /* Container for forms */
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    /* Crypto list styling */
    #cryptoList {
        display: flex;
        flex-wrap: wrap;
        align-content: center;
        justify-content: center;
        align-items: baseline;
        flex-direction: column;
        padding: 0;
    }

    #cryptoList li {
        background-color: lightgrey;
        border: 1px solid #333;
        padding: 20px;
        border-radius: 10px;
        margin: 10px;
        list-style-type: none;
    }

    /* Responsive tweak */
    @media (max-width: 768px) {
        form {
            grid-template-columns: 1fr;
            justify-items: start;
        }
    }
</style>

<script>
    function editCrypto(cryptoId, userId, cryptoName, tdate, fromWallet, toWallet, quantity, price, currency, fee, note) {
        document.getElementById("updateCryptoId").value = cryptoId;
        document.getElementById("updateUserId").value = userId;
        document.getElementById("updateCryptoName").value = cryptoName;
        document.getElementById("updateTdate").value = tdate;
        document.getElementById("updateFromWallet").value = fromWallet;
        document.getElementById("updateToWallet").value = toWallet;
        document.getElementById("updateQuantity").value = quantity;
        document.getElementById("updatePrice").value = price;
        document.getElementById("updateCurrency").value = currency;
        document.getElementById("updateFee").value = fee;
        document.getElementById("updateNote").value = note;
        document.getElementById("updateCryptoDiv").style.display = "block";
        document.getElementById("cryptoListDiv").style.display = "none";
        document.getElementById("newCryptoB").style.display = "none"; 
        document.getElementById("deleteForm").action = `/deleteCrypto/${cryptoId}/${userId}`;
    }  

    document.addEventListener("DOMContentLoaded", function() {
        let list = document.getElementById("cryptoList");
        let items = Array.from(list.children);

        items.sort((a, b) => {
            let dateA = new Date(a.getAttribute("data-tdate"));
            let dateB = new Date(b.getAttribute("data-tdate"));
            return dateB - dateA;  
        });

        items.forEach(item => list.appendChild(item));
    });

    function newCryptoDiv() {
        let div = document.getElementById("newCrypto");
        let button = document.getElementById("newCryptoB");

        if (div.style.display === "none" || div.style.display === "") {
            div.style.display = "block";  
            document.getElementById("cryptoListDiv").style.display = "none";
            button.style.display = "none";
        } else {
            div.style.display = "none"; 
            document.getElementById("cryptoListDiv").style.display = "block";
            button.innerText = "Add New Crypto";
        }
    }
</script>


<h1 style="text-align: left;">Cryptos Manager</h1>

<button id="newCryptoB" onclick="newCryptoDiv()">Add New Crypto</button>

<div id="newCrypto" style="display: none;">
    <h2>New Crypto Transaction</h2>
    <div class="form-container">
        <form action="/crypto" method="POST">
            <div>
                <label for="cryptoName">Crypto:</label>
                <input type="text" name="cryptoName" required>
            </div>
            <div>
                <label for="tdate">Date:</label>
                <input type="datetime-local" name="tdate" required>
            </div>
            <div>
                <label for="fromWallet">From Wallet:</label>
                <select name="fromWallet" id="fromWallet" required>
                    <option value="">-- Select Wallet --</option> 
                    {% for wallet in wallets %}
                    <option value="{{ wallet['walletId'] }}">{{ wallet['walletName'] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="toWallet">To Wallet:</label>
                <input type="text" name="toWallet" required>
            </div>
            <div>
                <label for="quantity">Quantity:</label>
                <input type="text" name="quantity" required>
            </div>
            <div>
                <label for="price">Price:</label>
                <input type="text" name="price" required>
            </div>
            <div>
                <label for="currency">Currency:</label>
                <input type="text" name="currency" required>
            </div>
            <div>
                <label for="fee">Fee:</label>
                <input type="text" name="fee">
            </div>
            <div>
                <label for="note">Note:</label>
                <input type="text" name="note">
            </div>
            <div>
                <button type="submit">Insert</button>
                <button type="reset">Clear</button>
                <button type="button" onclick="location.reload();">Cancel</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

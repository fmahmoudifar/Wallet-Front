<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Flask App{% endblock %}</title>
    <script>
        // Theme: prefer localStorage, fallback to server session setting.
        (function () {
            try {
                const stored = localStorage.getItem('theme');
                const serverTheme = "{{ session.get('theme', 'Light') }}";
                const raw = (stored || serverTheme || 'Light');
                const t = String(raw).toLowerCase();
                const theme = t.startsWith('d') ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="/static/css/site_styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% block head_extra %}{% endblock %}
</head>
<body>

    <div class="app-shell">
        <aside class="app-sidebar" aria-label="Main navigation">
            <div class="app-brand">
                <a href="/" class="app-brand-link">My Wallets</a>
            </div>

            <nav class="app-nav">
                {% if session.get('user') %}
                    <a class="app-nav-link" href="/" {% if request.path == '/' %}aria-current="page"{% endif %}>Home</a>
                    <a class="app-nav-link" href="/wallet" {% if request.path.startswith('/wallet') %}aria-current="page"{% endif %}>Wallets</a>

                    <a class="app-nav-link" href="/fiat" {% if request.path.startswith('/fiat') %}aria-current="page"{% endif %}>Fiat</a>
                    {% if request.path.startswith('/fiat') %}
                        <div class="app-subnav app-subnav-inline" aria-label="Fiat sections">
                            <button type="button" class="app-subnav-link" data-fiat-nav="dashboard" onclick="showFiatDashboard()">Overview</button>
                            <button type="button" class="app-subnav-link" data-fiat-nav="new" onclick="newTransDiv()">New Transaction</button>
                            <button type="button" class="app-subnav-link" data-fiat-nav="history" onclick="transHistoryDiv()">Transactions History</button>
                        </div>
                    {% endif %}

                    <a class="app-nav-link" href="/crypto" {% if request.path.startswith('/crypto') %}aria-current="page"{% endif %}>Crypto</a>
                    {% if request.path.startswith('/crypto') %}
                        <div class="app-subnav app-subnav-inline" aria-label="Crypto sections">
                            <button type="button" class="app-subnav-link" data-crypto-nav="portfolio" onclick="showCryptoPortfolio()">Portfolio</button>
                            <button type="button" class="app-subnav-link" data-crypto-nav="new" onclick="newCryptoDiv()">New Crypto Transaction</button>
                            <button type="button" class="app-subnav-link" data-crypto-nav="history" onclick="cryptoHistoryDiv()">Transactions History</button>
                        </div>
                    {% endif %}

                    <a class="app-nav-link" href="/stock" {% if request.path.startswith('/stock') %}aria-current="page"{% endif %}>Stock</a>
                    {% if request.path.startswith('/stock') %}
                        <div class="app-subnav app-subnav-inline" aria-label="Stock sections">
                            <button type="button" class="app-subnav-link" data-stock-nav="portfolio" onclick="showStockPortfolio()">Portfolio</button>
                            <button type="button" class="app-subnav-link" data-stock-nav="new" onclick="newStockDiv()">New Stock Transaction</button>
                            <button type="button" class="app-subnav-link" data-stock-nav="history" onclick="stockHistoryDiv()">Transactions History</button>
                        </div>
                    {% endif %}
                    <a class="app-nav-link" href="/settings" {% if request.path.startswith('/settings') %}aria-current="page"{% endif %}>Settings</a>
                    <a class="app-nav-link app-nav-link-logout" href="/logout">Logout</a>
                {% else %}
                    <a class="app-nav-link" href="/login" {% if request.path.startswith('/login') %}aria-current="page"{% endif %}>Login</a>
                {% endif %}
            </nav>
        </aside>

        <main class="app-main">
            <div class="app-content">
                {% block content %}
                {% endblock %}
            </div>
        </main>
    </div>

    {% if session.get('user') %}
    <nav class="app-bottom-nav" aria-label="Bottom navigation">
        <a class="app-bottom-link" href="/" aria-label="Home" {% if request.path == '/' %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M3 10.5 12 3l9 7.5v9.5a1 1 0 0 1-1 1h-5.5v-6.5h-5V21H4a1 1 0 0 1-1-1z" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
            </svg>
            <span class="sr-only">Home</span>
        </a>
        <a class="app-bottom-link" href="/wallet" aria-label="Wallets" {% if request.path.startswith('/wallet') %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 7.5A2.5 2.5 0 0 1 6.5 5h11A2.5 2.5 0 0 1 20 7.5v9A2.5 2.5 0 0 1 17.5 19h-11A2.5 2.5 0 0 1 4 16.5z" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <path d="M20 9h-4.5a2 2 0 0 0 0 4H20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M16.5 11h.01" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round"/>
            </svg>
            <span class="sr-only">Wallets</span>
        </a>
        <a class="app-bottom-link" href="/fiat" aria-label="Transactions" {% if request.path.startswith('/fiat') %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 7h13l-3-3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M17 17H4l3 3" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="sr-only">Transactions</span>
        </a>
        <a class="app-bottom-link" href="/crypto" aria-label="Crypto" {% if request.path.startswith('/crypto') %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <!-- Coin stack (clean + crisp) -->
                <ellipse cx="12" cy="7" rx="6.5" ry="2.5" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <path d="M5.5 7v4c0 1.4 2.9 2.5 6.5 2.5s6.5-1.1 6.5-2.5V7" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <path d="M5.5 11v4c0 1.4 2.9 2.5 6.5 2.5s6.5-1.1 6.5-2.5v-4" fill="none" stroke="currentColor" stroke-width="1.8"/>
            </svg>
            <span class="sr-only">Crypto</span>
        </a>
        <a class="app-bottom-link" href="/stock" aria-label="Stocks" {% if request.path.startswith('/stock') %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M4 19V5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M4 19h16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                <path d="M6.5 15.5 10 12l3 2.2 4.5-6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="sr-only">Stocks</span>
        </a>
        <a class="app-bottom-link" href="/settings" aria-label="Settings" {% if request.path.startswith('/settings') %}aria-current="page"{% endif %}>
            <svg class="app-bottom-icon" viewBox="0 0 24 24" aria-hidden="true">
                <!-- Sliders (clean settings icon) -->
                <path d="M5 7h14" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <path d="M5 12h14" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <path d="M5 17h14" fill="none" stroke="currentColor" stroke-width="1.8"/>
                <circle cx="9" cy="7" r="1.8" fill="#fff" stroke="currentColor" stroke-width="1.8"/>
                <circle cx="15" cy="12" r="1.8" fill="#fff" stroke="currentColor" stroke-width="1.8"/>
                <circle cx="11" cy="17" r="1.8" fill="#fff" stroke="currentColor" stroke-width="1.8"/>
            </svg>
            <span class="sr-only">Settings</span>
        </a>
    </nav>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Enhance all date-time inputs that opt-in via data-dt-picker="1".
        // Keeps submitted value in ISO-like format: YYYY-MM-DDTHH:MM.
        document.addEventListener('DOMContentLoaded', function () {
            if (!window.flatpickr) return;
            const inputs = document.querySelectorAll('input[data-dt-picker="1"]');
            inputs.forEach((input) => {
                const wasRequired = !!input.required;
                flatpickr(input, {
                    enableTime: true,
                    time_24hr: true,
                    allowInput: true,
                    dateFormat: 'Y-m-d\\TH:i',
                    altInput: true,
                    altFormat: 'd/m/Y H:i',
                    onReady: function (_selectedDates, _dateStr, instance) {
                        // Move required validation to the visible alt input.
                        if (wasRequired && instance.altInput) {
                            instance.altInput.required = true;
                            input.required = false;
                        }
                    }
                });
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 
